;/*FB_PKG_DELIM*/

__d("isFacebookishURI",["isFacebookURI","isMessengerDotComURI"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("isFacebookURI")(a)||c("isMessengerDotComURI")(a)}g["default"]=a}),98);
__d("ZenonSignalingTransportTypes",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({CHILD_WINDOW_READY:"rtc_child_window_ready",PARENT_INITIATED_CALL:"rtc_child_window_start_call",PARENT_QPL_MARKER:"rtc_parent_qpl_marker",PARENT_TO_CHILD_MESSAGE:"rtc_child_window_message"});f.ChildTransportMessageType=a}),66);
__d("ZenonSignalingParentTransport",["QuickPerformanceLogger","RTWebIncomingRingConfiguration","Random","URI","ZenonBrowsers","ZenonIGMediaUtil","ZenonMWMessageTranslator","ZenonMWMessageTypes","ZenonSignalingTransportTypes","isFacebookishURI","qpl","recoverableViolation","shouldUseSFUMediaPath"],(function(a,b,c,d,e,f,g){"use strict";var h=45*1e3;a=function(){function a(){var a=this;this.verificationNonce=null;this.portToChild=null;this.$1=null;this.$2=null;this.$3=new Map();this.$4=new Map();d("RTWebIncomingRingConfiguration").isSupportedClient()&&window.addEventListener&&window.addEventListener("message",function(b){a.handleWindowMessageFromChild(b)},!1)}var b=a.prototype;b.handleWindowMessageFromChild=function(a){var b=this;if(this.windowMessageValid(a)&&a.data.type===d("ZenonSignalingTransportTypes").ChildTransportMessageType.CHILD_WINDOW_READY&&this.hasPort(a)){var c;c=(c=a.data.roomID)!=null?c:null;var e=a.data.serverInfoData;this.portToChild=a.ports[0];a=a.data.childNonce;this.$2=a;window.clearTimeout(this.$1);this.$1=window.setTimeout(function(){b.portToChild=null},h);this.verificationNonce=this.generateNonce();this.startCallInChildWindow(c,e);this.sendQPLToChildWindow()}};b.generateNonce=function(){return String(d("Random").random())};b.hasPort=function(a){return Boolean(a.ports!=null&&Array.isArray(a.ports)&&a.ports[0]!=null)};b.startCallInChildWindow=function(a,b){var c=null;if(b!==void 0){if(b!=null){c=i((b=this.$4.get(b))!=null?b:null)}}else if(a!=null){c=i((b=this.$3.get(a))!=null?b:null)}a={mwRingRequest:c,nonce:this.$2,type:d("ZenonSignalingTransportTypes").ChildTransportMessageType.PARENT_INITIATED_CALL};this.sendMessageToChild(a)};b.sendQPLToChildWindow=function(){var a=c("QuickPerformanceLogger").activeMarkers.get(398997251);if(a){var b={markers:a,nonce:this.$2,type:d("ZenonSignalingTransportTypes").ChildTransportMessageType.PARENT_QPL_MARKER};this.sendMessageToChild(b);for(var b=a.keys(),a=Array.isArray(b),e=0,b=a?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(a){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;c("QuickPerformanceLogger").markerDrop(c("qpl")._(398997251,"1544"),f)}}};b.windowMessageValid=function(a){return Boolean(a.origin===window.location.origin||c("isFacebookishURI")(new(c("URI"))(a.origin))&&c("isFacebookishURI")(new(c("URI"))(window.location.origin)))&&this.postMessageValid(a)};b.postMessageValid=function(a){return Boolean(this.verificationNonce!==null&&(a==null?void 0:(a=a.data)==null?void 0:a.nonce)===this.verificationNonce)};b.sendMessageToChild=function(a){this.portToChild!=null?this.portToChild.postMessage(a):c("recoverableViolation")("The child window port should be available","rtc_www")};b.enqueueRawMWMessage=function(a){var b=a.jsonPayload,c=b.body;b=b.header;c=c.ringRequest;if(c){c=b.conferenceName;b=b.serverInfoData;this.$3.set(c,a);this.$4.set((c=b)!=null?c:null,a)}};b.testGetChildNonce=function(){return this.$2};return a}();function i(a){var b;if(a===null)return null;var c=d("ZenonMWMessageTranslator").toSignalingMessage(a);c=c.getEvents().find(function(a){return a.eventName==="inviteRequest"});if((c==null?void 0:c.eventName)!=="inviteRequest")return null;c=(c=(c=a.jsonPayload.body.ringRequest)==null?void 0:c.isLegacyCall)!=null?c:!1;b=((b=a.jsonPayload.body.ringRequest)==null?void 0:(b=b.e2eeEnforcement)==null?void 0:b.mode)===d("ZenonMWMessageTypes").ZenonMWE2eeMode.E2EE_MANDATED;return!b&&(c||!j())?a:k(a)}function j(){return d("ZenonBrowsers").isFirefox()||c("shouldUseSFUMediaPath")()||c("ZenonIGMediaUtil").shouldUseSFUOnly()}function k(a){var b;(b=a.jsonPayload.body.ringRequest)==null?void 0:delete b.offer;return a}g["default"]=a}),98);